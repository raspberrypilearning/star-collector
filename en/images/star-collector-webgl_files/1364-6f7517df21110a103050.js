(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1364],{51245:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var n=t(28140),o=t(93316);function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{wait:0},t=null,i=null,a=null,s=null;if(r.wait<0)throw new Error("wait must be 0 or more");if(r.maxWait){if(r.maxWait<0)throw new Error("maxWait must be 0 or more");if(r.maxWait<r.wait)throw new Error("maxWait must be higher than wait")}function c(){if(!r.maxWait)return r.wait;if(!a)throw new Error("Expected scheduledAt to be a set when getting wait");var e=Date.now()-a;return Math.min(r.maxWait-e,r.wait)}function u(){i&&clearTimeout(i),i=null,s=null,t=null,a=null}function l(){if(!t||!i)throw new Error("Expected to call debounced function once before flushing");var r=t,o=s;return u(),e.apply(void 0,(0,n.Z)(o)).then((function(e){return r.resolve(e),e})).catch((function(e){throw r.reject(e),e}))}function f(){if(!i||!t)throw new Error("Expected to call debounced function once before cancelling");var e=t;u(),e.reject(new Error("Debounced function cancelled"))}return Object.assign((function(){if(t){if(!i)throw new Error("Did not expect to have deferred and no timeout");clearTimeout(i)}else t=(0,o.Z)(),a=Date.now();for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return s=r,i=window.setTimeout((function(){l()}),c()),t.promise}),{isScheduled:function(){return Boolean(t&&i)},cancel:f,flush:l})}},93316:function(e,r,t){"use strict";function n(){var e,r,t={promise:new Promise((function(t,n){e=t,r=n})),resolve:function(r){t.isFulfilled=!0,e(r)},reject:function(e){t.isFulfilled=!0,r(e)},isFulfilled:!1};return t}t.d(r,{Z:function(){return n}})},45006:function(e,r,t){"use strict";t.d(r,{Q:function(){return n},o:function(){return o}});var n=".",o=".lesson"},56479:function(e,r,t){"use strict";t.d(r,{Z:function(){return ue}});var n=t(26265),o=t(809),i=t.n(o),a=t(92447),s=t(28140),c=t(3460),u=t(59137),l=t(51626),f=t(74143),p=t(45006),d=t(50055),h=t(74047),v=t(52700),m=t(4706),b=t(33814),y=t(44102),g=t(20775),w=t(17187),k=t(34606),x=t(18972),C=t(91296),E=t.n(C),O=t(89540),Z=t(53456),S=t(87644),T=t(2244),D=t(32292);function F(e,r){var t;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return j(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return j(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function j(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var R={replsList:function(){return"dataLossRepls"},replFiles:function(e){return"dataLossReplFiles".concat(e)},latestOp:function(e,r){return"dataLossLatestOp--".concat(e,"--").concat(r)},latestFlushedOp:function(e,r){return"dataLossLatestFlushed--".concat(e,"--").concat(r)},latestOwnOp:function(e,r){return"dataLosslatestOwnOp--".concat(e,"--").concat(r)}};function P(e,r){for(var t={latestOp:null,latestFlushedOp:null,latestOwnOp:null},n=0,o=Object.keys(t);n<o.length;n++){var i=o[n],a=localStorage.getItem(R[i](e,r));if(a){var s=void 0;try{s=JSON.parse(a)}catch(c){continue}s&&"object"===typeof s&&"number"===typeof s.crc32&&"number"===typeof s.version&&(t[i]=s)}}return t}function I(){var e=localStorage.getItem(R.replsList()),r=[];if(e){try{r=JSON.parse(e)}catch(t){localStorage.setItem(R.replsList(),"[]")}Array.isArray(r)||(r=[],localStorage.setItem(R.replsList(),"[]"))}return r}function N(e){var r=localStorage.getItem(R.replFiles(e)),t=[];if(r){try{t=JSON.parse(r)}catch(n){localStorage.setItem(R.replFiles(e),"[]")}Array.isArray(t)||(t=[],localStorage.setItem(R.replFiles(e),"[]"))}return t}function _(e){var r,t=F(N(e));try{for(t.s();!(r=t.n()).done;){var n=r.value;"string"===typeof n&&A(e,n)}}catch(i){t.e(i)}finally{t.f()}localStorage.removeItem(R.replFiles(e));var o=I().filter((function(r){return r!==e}));localStorage.setItem(R.replsList(),JSON.stringify(o))}function A(e,r){localStorage.removeItem(R.latestOp(e,r)),localStorage.removeItem(R.latestFlushedOp(e,r)),localStorage.removeItem(R.latestOwnOp(e,r));var t=N(e).filter((function(e){return e!==r}));localStorage.setItem(R.replFiles(e),JSON.stringify(t))}function L(e){var r=e.replId,t=e.filePath;!function(e){var r=I();r.includes(e)||(r.length>20?(_(r[0]),r[0]=e):r.push(e),localStorage.setItem(R.replsList(),JSON.stringify(r)))}(r);var n=N(r);n.includes(t)||(n.length>20?(_(n[0]),n[0]=t):n.push(t),localStorage.setItem(R.replFiles(r),JSON.stringify(n)))}function U(e){var r=e.filePath,t=e.replId,n=e.opType,o=e.op;localStorage.setItem(R[n](t,r),JSON.stringify(o))}var M={};function B(e){return z.apply(this,arguments)}function z(){return(z=(0,a.Z)(i().mark((function e(r){var t,n,o,s,c,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.filePath,n=r.replId,o=r.serverVersion,s=r.serverContent,c=r.fetchOps,!M[t+n]){e.next=3;break}return e.abrupt("return");case 3:M[t+n]=!0,u=P(n,t),l=k.str(s)>>>0,Object.keys(u).forEach(function(){var e=(0,a.Z)(i().mark((function e(r){var t,n,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u[r]){e.next=3;break}return e.abrupt("return");case 3:if(!(o<t.version)){e.next=6;break}return Z.kg.info("ot client dataloss",{opType:r,case:"server_forgot"}),e.abrupt("return");case 6:if(o!==t.version){e.next=9;break}return l!==t.crc32&&Z.kg.info("ot client dataloss",{opType:r,case:"crc32_mistmach"}),e.abrupt("return");case 9:return e.prev=9,e.next=12,c(t.version,t.version);case 12:a=e.sent,s=(0,D.Z)(a,1),n=s[0],e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(9),Z.kg.info("ot client dataloss",{opType:r,case:"error_fetching_op"}),e.abrupt("return");case 21:if(n){e.next=24;break}return Z.kg.info("ot client dataloss",{opType:r,case:"op_not_found"}),e.abrupt("return");case 24:n.crc32!==t.crc32&&Z.kg.info("ot client dataloss",{opType:r,case:"crc32_mismatch"});case 25:case"end":return e.stop()}}),e,null,[[9,17]])})));return function(r){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function q(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?V(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function W(e,r){var t;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return G(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){function r(r){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}((function(e){throw e})),f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){function r(r){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}((function(e){s=!0,i=e})),f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function G(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function J(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,g.Z)(e);if(r){var o=(0,g.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,y.Z)(this,t)}}function H(e){return e.map((function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"===typeof e.insert)return e.insert;throw new Error("Unexpected op type")}))}var $=function(e){(0,b.Z)(t,e);var r=J(t);function t(e,o){var s;return(0,h.Z)(this,t),s=r.call(this),(0,n.Z)((0,m.Z)(s),"linkedFile",void 0),(0,n.Z)((0,m.Z)(s),"channel",void 0),(0,n.Z)((0,m.Z)(s),"destroy",void 0),(0,n.Z)((0,m.Z)(s),"pending",void 0),(0,n.Z)((0,m.Z)(s),"inflight",void 0),(0,n.Z)((0,m.Z)(s),"inflightOpsPromise",void 0),(0,n.Z)((0,m.Z)(s),"version",void 0),(0,n.Z)((0,m.Z)(s),"serverContent",void 0),(0,n.Z)((0,m.Z)(s),"localContent",void 0),(0,n.Z)((0,m.Z)(s),"pendingCursors",void 0),(0,n.Z)((0,m.Z)(s),"flushedCursorIds",void 0),(0,n.Z)((0,m.Z)(s),"user",void 0),(0,n.Z)((0,m.Z)(s),"debounceSend",void 0),(0,n.Z)((0,m.Z)(s),"debounceCommit",void 0),(0,n.Z)((0,m.Z)(s),"commitPromise",void 0),(0,n.Z)((0,m.Z)(s),"isReconnecting",void 0),(0,n.Z)((0,m.Z)(s),"shouldTrackReconnects",void 0),(0,n.Z)((0,m.Z)(s),"shouldTrackDataLoss",void 0),(0,n.Z)((0,m.Z)(s),"replId",void 0),(0,n.Z)((0,m.Z)(s),"uncommittedOps",void 0),(0,n.Z)((0,m.Z)(s),"hasUncommittedMultiplayerOps",void 0),(0,n.Z)((0,m.Z)(s),"committedVersion",void 0),(0,n.Z)((0,m.Z)(s),"committedContent",void 0),(0,n.Z)((0,m.Z)(s),"bufferedReconnectingOps",void 0),(0,n.Z)((0,m.Z)(s),"didEditOffline",void 0),(0,n.Z)((0,m.Z)(s),"reconnectTrackedData",void 0),(0,n.Z)((0,m.Z)(s),"timeDisconnected",void 0),(0,n.Z)((0,m.Z)(s),"writeOps",(function(e){if(!s.channel&&!s.isReconnecting)throw new Error("Trying to send changes before ever coming online");s.isReconnecting&&(s.didEditOffline=!0);var r,t=s.localContent,n=[],o=0,i=W(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,c=null;switch(typeof a){case"number":o+=a;break;case"string":var u=(0,O.strPosToUni)(t,o);c=u>0?[u,a]:[a],o+=a.length;break;case"object":var l=(0,O.strPosToUni)(t,o),f=(0,O.strPosToUni)(t,o+a.d)-l;c=l>0?[l,{d:f}]:[{d:f}];break;default:return void s.emit("error",new Error("OT Error: unknown op type"))}c&&(t=x.type.apply(t,c),n=x.type.compose(n,c))}}catch(p){i.e(p)}finally{i.f()}s.pending=x.type.compose(s.pending,n),s.localContent=t,0!==s.pending.length?s.emit("fileDirty"):s.commitPromise&&s.emit("commitStart"),s.debounceSend()})),(0,n.Z)((0,m.Z)(s),"updateCursors",(function(e){s.pendingCursors=e,s.debounceSend()})),(0,n.Z)((0,m.Z)(s),"isClean",(function(){return s.committedVersion===s.version&&0===s.inflight.length&&0===s.pending.length})),(0,n.Z)((0,m.Z)(s),"sendOps",(function(){if(s.channel&&"open"===s.channel.status&&!s.isReconnecting&&!(s.inflight.length>0)){if(0!==s.pending.length){var e=s.pending.map((function(e){return"object"===typeof e?{delete:e.d}:"number"===typeof e?{skip:e}:{insert:e}}));s.inflight=s.pending,s.pending=[],s.inflightOpsPromise=s.channel.request({ot:{spookyVersion:s.version,ops:e}}),s.inflightOpsPromise.then((function(r){r.error&&s.emit("error",new Error("OT Error: error accepting packet"),{originalError:r.error,ops:e})}))}if(0!==s.pendingCursors.length){var r,t=W(s.flushedCursorIds);try{for(t.s();!(r=t.n()).done;){var n=r.value;s.channel.send({otDeleteCursor:{id:n}})}}catch(u){t.e(u)}finally{t.f()}s.flushedCursorIds=[];var o,i=W(s.pendingCursors);try{for(i.s();!(o=i.n()).done;){var a=o.value,c=Number(Math.random().toString().split(".")[1]).toString(36);s.flushedCursorIds.push(c),s.channel.send({otNewCursor:q({id:c,user:s.user},a)})}}catch(u){i.e(u)}finally{i.f()}s.pendingCursors=[]}}})),(0,n.Z)((0,m.Z)(s),"handlePacket",(function(e,r){var t=e.ops,n=e.version,o=e.crc32,i=r.overrideReconnectringBuffer;if(!s.isReconnecting||i)if(-1!==s.version){if(s.version++,n!==s.version){var a={expectedVersion:s.version,receievedVersion:n,incomingOps:t};return Z.kg.error("OT Error: invalid server version",(0,Z.P1)({details:a})),void s.emit("error",new Error("OT Error: invalid server version"),a)}var c="";try{c=x.type.apply(s.serverContent,t)}catch(C){return void s.emit("error",new Error("OT Error: unable to apply updated content"),{originalError:C,incomingOps:t})}var u=k.str(c)>>>0;if(u!==o){var l={version:n,server:o,client:u,incomingOps:t};return Z.kg.error("OT Error: crc32 mismatch",(0,Z.P1)({details:l})),void s.emit("error",new Error("OT Error: crc32 mismatch"),l)}if(s.uncommittedOps.push({version:n,crc32:o,ops:t}),s.shouldTrackDataLoss&&U({replId:s.replId,filePath:s.linkedFile,opType:"latestOp",op:{version:n,crc32:o}}),JSON.stringify(t)===JSON.stringify(s.inflight))return s.shouldTrackDataLoss&&U({replId:s.replId,filePath:s.linkedFile,opType:"latestOwnOp",op:{version:n,crc32:o}}),s.debounceCommit(),s.inflight=[],s.inflightOpsPromise=null,s.serverContent=c,s.debounceSend(),void s.debounceSend.flush();if(s.commitPromise||s.emit("fileDirty"),s.debounceCommit(),s.hasUncommittedMultiplayerOps=!0,s.inflight.length){var f=x.type.transform(s.inflight,t,"right");t=x.type.transform(t,s.inflight,"left"),s.inflight=f}if(s.pending.length){var p=x.type.transform(s.pending,t,"right");t=x.type.transform(t,s.pending,"left"),s.pending=p}s.localContent=x.type.apply(s.localContent,t);var d,h=[],v=0,m=W(t);try{for(m.s();!(d=m.n()).done;){var b=d.value;switch(typeof b){case"number":v+=b;break;case"string":var y=(0,O.uniToStrPos)(s.localContent,v);h=y>0?T.qC(h,[y,b]):T.qC(h,[b]),v+=(0,O.strPosToUni)(b);break;case"object":var g=(0,O.uniToStrPos)(s.localContent,v),w=(0,O.uniToStrPos)(s.localContent,v+b.d)-g;h=g>0?T.qC(h,[g,{d:w}]):T.qC(h,[{d:w}]);break;default:return void s.emit("error",new Error("OT Error: unknown op type"))}}}catch(E){m.e(E)}finally{m.f()}s.serverContent=c,s.emit("op",h)}else s.emit("error",new Error("Got packet while version is still -1, expected version to be set in handleStatus"));else s.bufferedReconnectingOps.push({crc32:o,ops:t,version:n})})),(0,n.Z)((0,m.Z)(s),"handleNewCursor",(function(e){s.emit("cursor",e)})),(0,n.Z)((0,m.Z)(s),"handleDeleteCursor",(function(e){var r=e.id;s.emit("removeCursor",r)})),(0,n.Z)((0,m.Z)(s),"handleStatus",function(){var e=(0,a.Z)(i().mark((function e(r){var t,n,o,a,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.channel&&"open"===s.channel.status){e.next=2;break}return e.abrupt("return");case 2:if(!r.linkedFile){e.next=25;break}if(null!=r.contents){e.next=6;break}return s.emit("error",new Error("expected status contents,  got null or undefined")),e.abrupt("return");case 6:if(null!=r.cursors){e.next=9;break}return s.emit("error",new Error("expected status cursors, got null or undefined")),e.abrupt("return");case 9:if(null!=r.version){e.next=12;break}return s.emit("error",new Error("expected status version, got null or undefined")),e.abrupt("return");case 12:if(!s.isReconnecting){e.next=15;break}return s.handleReconnect(r.contents,r.version),e.abrupt("return");case 15:return s.shouldTrackDataLoss&&B({serverContent:r.contents,serverVersion:r.version,replId:s.replId,filePath:s.linkedFile,fetchOps:s.fetchOps}),s.serverContent=r.contents,s.localContent=s.serverContent,s.version=r.version,s.emit("firstConnect"),s.emit("op",[s.serverContent]),r.cursors.forEach(s.handleNewCursor),s.emit("fileDirty"),s.debounceCommit(),e.abrupt("return");case 25:return e.next=27,s.channel.request({otLinkFile:{file:{path:s.linkedFile},highConsistency:Boolean(window["flag-ot-high-consitency"])}});case 27:if(!(o=e.sent).channelClosed){e.next=30;break}return e.abrupt("return");case 30:if(!o.error){e.next=33;break}return s.emit("error",new Error("link file error "+o.error)),e.abrupt("return");case 33:if(o.otLinkFileResponse){e.next=36;break}return s.emit("error",new Error("link file error "+JSON.stringify(o.toJSON()))),e.abrupt("return");case 36:if(a=o.otLinkFileResponse.version,u=c.Z.from(null!==(t=null===(n=o.otLinkFileResponse.linkedFile)||void 0===n?void 0:n.content)&&void 0!==t?t:"").toString(),l=[u],!s.isReconnecting){e.next=42;break}return s.handleReconnect(u,a),e.abrupt("return");case 42:s.shouldTrackDataLoss&&B({serverContent:u,serverVersion:a,replId:s.replId,filePath:s.linkedFile,fetchOps:s.fetchOps}),s.serverContent=u,s.localContent=s.serverContent,s.version=a,s.committedVersion=a,s.committedContent=s.serverContent,s.emit("firstConnect"),s.emit("op",l);case 50:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),(0,n.Z)((0,m.Z)(s),"handleReconnect",function(){var e=(0,a.Z)(i().mark((function e(r,t){var n,o,a,c,u,l,f,p,d,h,v,m,b,y,g,w,k,C,E,O,Z,T,D,F,j,R,P,I,N,_,A;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.timeDisconnected){e.next=2;break}throw new Error("wat");case 2:if(n=Date.now()-s.timeDisconnected,o=function(e){s.reconnectTrackedData=q(q({},e),{},{serverVersion:t,ourVersion:s.version,ourCommittedVersion:s.committedVersion,areContentsEqual:s.serverContent===r,areCommittedContentsEqual:s.committedContent===r,didReceiveOpsWhileReconnecting:Boolean(s.bufferedReconnectingOps),didEditOffline:s.didEditOffline,hasPendingOps:Boolean(s.pending.length),disconnectDuration:n}),s.shouldTrackReconnects&&(0,S.track)(S.events.FILE_RECONNECTED_STATUS2,s.reconnectTrackedData)},a=function(){s.isReconnecting=!1,s.bufferedReconnectingOps=[],s.didEditOffline=!1,s.timeDisconnected=null,s.debounceSend(),s.debounceCommit(),s.emit("reconnected")},!s.inflight.length){e.next=23;break}if(t!==s.version||s.serverContent!==r){e.next=13;break}return o({case:"has_inflight_happy_path_ops_unreached",prompted:!1}),s.pending=x.type.compose(s.inflight,s.pending),s.inflight=[],s.inflightOpsPromise=null,a(),e.abrupt("return");case 13:c=!1,u=s.serverContent;try{u=x.type.apply(r,s.inflight)}catch(i){c=!0}if(c||s.version+1!==t||u!==r){e.next=20;break}return o({case:"has_inflight_happy_path_ops_reached",prompted:!0}),s.emit("promptUserReconnect"),e.abrupt("return");case 20:return o({case:"has_inflight",prompted:!0}),s.emit("promptUserReconnect"),e.abrupt("return");case 23:if(!s.hasUncommittedMultiplayerOps){e.next=27;break}return o({case:"multiplayer",prompted:!0}),s.emit("promptUserReconnect"),e.abrupt("return");case 27:if(s.version!==t){e.next=35;break}if(r!==s.serverContent){e.next=32;break}return o({case:"happy_path",prompted:!1}),a(),e.abrupt("return");case 32:return o({case:"same_version_different_content",prompted:!0}),s.emit("promptUserReconnect"),e.abrupt("return");case 35:if(s.committedVersion!==t){e.next=61;break}l=r,e.prev=37,f=W(s.uncommittedOps);try{for(f.s();!(p=f.n()).done;)d=p.value.ops,l=x.type.apply(l,d)}catch(L){f.e(L)}finally{f.f()}e.next=47;break;case 42:return e.prev=42,e.t0=e.catch(37),o({case:"same_committed_version_unable_to_apply_ops",prompted:!0}),s.emit("promptUserReconnect"),e.abrupt("return");case 47:if(l!==s.serverContent){e.next=58;break}o({case:"happy_path_uncommitted",prompted:!1}),h=[],v=W(s.uncommittedOps);try{for(v.s();!(m=v.n()).done;)b=m.value.ops,h=x.type.compose(h,b)}catch(L){v.e(L)}finally{v.f()}return s.pending=x.type.compose(h,s.pending),s.uncommittedOps=[],s.version=t,s.serverContent=r,a(),e.abrupt("return");case 58:return o({case:"same_committed_version_different_content_fixed",prompted:!0}),s.emit("promptUserReconnect"),e.abrupt("return");case 61:if(!(s.version<t)){e.next=85;break}return e.next=64,s.fetchOps(s.version+1,t);case 64:y=e.sent,g=!1,w=s.serverContent;try{k=W(y);try{for(k.s();!(C=k.n()).done;)E=C.value.ops,w=x.type.apply(w,E)}catch(L){k.e(L)}finally{k.f()}}catch(i){g=!0}if(g||w!==r){e.next=76;break}o({case:"happy_path_server_ahead",prompted:!1}),O=W(y);try{for(O.s();!(Z=O.n()).done;)T=Z.value,s.handlePacket(T,{overrideReconnectringBuffer:!0})}catch(L){O.e(L)}finally{O.f()}D=W(s.bufferedReconnectingOps);try{for(D.s();!(F=D.n()).done;)j=F.value,s.handlePacket(j,{overrideReconnectringBuffer:!0})}catch(L){D.e(L)}finally{D.f()}return a(),e.abrupt("return");case 76:return e.next=78,s.fetchOps(s.committedVersion+1,t);case 78:R=e.sent,P=!1,I=s.committedContent;try{N=W(R);try{for(N.s();!(_=N.n()).done;)A=_.value.ops,I=x.type.apply(I,A)}catch(L){N.e(L)}finally{N.f()}}catch(i){P=!0}return P||I!==r||o({case:"happy_path_uncommitted_server_ahead",prompted:!0}),s.emit("promptUserReconnect"),e.abrupt("return");case 85:o({case:"other",prompted:!0}),s.emit("promptUserReconnect");case 87:case"end":return e.stop()}}),e,null,[[37,42]])})));return function(r,t){return e.apply(this,arguments)}}()),(0,n.Z)((0,m.Z)(s),"flush",(0,a.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.commitPromise;case 2:return s.debounceCommit(),s.debounceCommit.flush(),e.next=6,s.commitPromise;case 6:case"end":return e.stop()}}),e)})))),(0,n.Z)((0,m.Z)(s),"fetchOps",function(){var e=(0,a.Z)(i().mark((function e(r,t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.channel){e.next=2;break}throw new Error("No cahnnel, cannot fetch");case 2:return e.next=4,s.channel.request({otFetchRequest:{versionFrom:r,versionTo:t}});case 4:if(!(n=e.sent).channelClosed){e.next=7;break}throw new Error("Channel closed while requesting");case 7:if(!n.error){e.next=9;break}throw new Error("Fetch ops returned an error"+n.error);case 9:if(n.otFetchResponse){e.next=11;break}throw new Error("Expected otFetchResponse");case 11:if(n.otFetchResponse.packets){e.next=13;break}throw new Error("Expected otFetchResponse.packets");case 13:return e.abrupt("return",n.otFetchResponse.packets.map((function(e){var r=e.crc32,t=e.ops,n=e.version;if(null==r)throw new Error("Expected crc32 in packet");if(null==t)throw new Error("Expected ops in packet");if(null==n)throw new Error("Expected version in packet");return{crc32:r,version:n,ops:H(t)}})));case 14:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),(0,n.Z)((0,m.Z)(s),"transformSelection",function(){var e=(0,a.Z)(i().mark((function e(r){var t,n,o,a,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.indexStart,n=r.indexEnd,o=r.versionFrom,a=r.versionTo,s.channel){e.next=3;break}throw new Error("No channel, cannot fetch");case 3:return e.next=5,s.channel.request({otTransformSelectionRequest:{indexStart:t,indexEnd:n,versionFrom:o,versionTo:a}});case 5:if((c=e.sent).otTransformSelectionResponse){e.next=8;break}throw new Error("Expected otTransformSelectionResponse");case 8:return e.abrupt("return",c.otTransformSelectionResponse);case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),s.shouldTrackDataLoss=!1,s.replId="",s.linkedFile=e,s.channel=null,s.inflight=[],s.inflightOpsPromise=null,s.uncommittedOps=[],s.hasUncommittedMultiplayerOps=!1,s.committedVersion=-1,s.isReconnecting=!1,s.bufferedReconnectingOps=[],s.didEditOffline=!1,s.pending=[],s.version=-1,s.serverContent="",s.localContent="",s.committedContent="",s.flushedCursorIds=[],s.pendingCursors=[],s.user=null,s.debounceSend=E()((function(){return s.sendOps()}),20,{maxWait:60}),s.debounceCommit=E()((function(){return s.commitToDisk()}),1e3,{maxWait:3e3}),s.commitPromise=null,s.timeDisconnected=null,s.shouldTrackReconnects=!1,s.destroy=o.openChannel({service:"ot",name:"ot:".concat(e)},(function(r){if(!r.error){var t=r.channel,n=r.context;return s.user=n.currentUser?{name:n.currentUser.username,id:n.currentUser.id}:null,n.currentUser&&n.repl&&(s.shouldTrackDataLoss=n.currentUser.flagTrackOtClientDataLoss,s.replId=n.repl.id,s.shouldTrackDataLoss&&L({replId:s.replId,filePath:e})),s.channel=t,t.onCommand((function(e){switch(e.body){case"ot":if(!e.ot||null==e.ot.ops||null==e.ot.spookyVersion||null==e.ot.crc32)return void s.emit("error",new Error("OT Error: missing data in ot packet"),e.ot||{});if(-1===s.version)return;var r={crc32:e.ot.crc32,ops:H(e.ot.ops),version:e.ot.spookyVersion};return s.handlePacket(r,{overrideReconnectringBuffer:!1});case"otstatus":return s.handleStatus(e.otstatus);case"error":if(e.ref)return;return s.emit("error",new Error("Unkown protocol error OT channel"),{originalError:e.error||"Server error"});case"otNewCursor":return s.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return s.handleDeleteCursor(e.otDeleteCursor)}})),function(){s.channel=null,s.isReconnecting=!0,s.debounceSend.cancel(),s.debounceCommit.cancel(),s.timeDisconnected||(s.timeDisconnected=Date.now())}}})),s}return(0,v.Z)(t,[{key:"commitToDisk",value:function(){var e=(0,a.Z)(i().mark((function e(){var r,t,n,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channel){e.next=2;break}throw new Error("Tryna commit while offline");case 2:if("open"===this.channel.status){e.next=4;break}return e.abrupt("return");case 4:if(!this.isReconnecting){e.next=6;break}throw new Error("Committing while reconnecting");case 6:if(!this.isClean()){e.next=8;break}return e.abrupt("return");case 8:if(!this.commitPromise){e.next=11;break}return this.debounceCommit(),e.abrupt("return");case 11:if(r=function(){},this.commitPromise=new Promise((function(e){return r=e})),!this.inflightOpsPromise){e.next=21;break}return e.next=16,this.inflightOpsPromise;case 16:if(!e.sent.channelClosed){e.next=21;break}return this.commitPromise=null,r(),e.abrupt("return");case 21:if(!(this.pending.length>0)){e.next=36;break}if(this.debounceSend(),this.debounceSend.flush(),this.inflightOpsPromise){e.next=29;break}return this.commitPromise=null,r(),this.emit("error",new Error("expected inflight promise")),e.abrupt("return");case 29:return e.next=31,this.inflightOpsPromise;case 31:if(!e.sent.channelClosed){e.next=36;break}return this.commitPromise=null,r(),e.abrupt("return");case 36:return this.emit("commitStart"),t=this.version,n=this.serverContent,e.next=41,this.channel.request({flush:{}});case 41:if(!(o=e.sent).channelClosed){e.next=46;break}return this.commitPromise=null,r(),e.abrupt("return");case 46:if("ok"===o.body){e.next=51;break}return this.commitPromise=null,r(),this.emit("error",new Error("OT Error: unable to flush"),{originalError:o.error||o.toString()}),e.abrupt("return");case 51:return this.shouldTrackDataLoss&&(a=this.uncommittedOps[this.uncommittedOps.length-1])&&U({replId:this.replId,filePath:this.linkedFile,op:{crc32:a.crc32,version:a.version},opType:"latestFlushedOp"}),this.uncommittedOps=[],this.hasUncommittedMultiplayerOps=!1,this.committedVersion=t,this.committedContent=n,this.emit("commitComplete",t),this.isClean()&&this.emit("fileClean"),this.commitPromise=null,r(),e.abrupt("return",o);case 61:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(w.EventEmitter),K=t(51339),Q=t(37348),X=t.n(Q),Y=t(71371),ee=t(51245),re=t(93316);function te(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function ne(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?te(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):te(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function oe(e,r){var t;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return ie(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ie(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function ie(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ae(e){return!!e.includes("no such file")||!!e.includes("file does not exist")}function se(e){return ae(e)?u.Df.NotFound:e.includes("file exist")?u.Df.AlreadyExists:e.includes("not a directory")?u.Df.NotDirectory:void 0}function ce(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return new Promise((function(r,n){setTimeout((function(){e.apply(void 0,t).then(r).catch(n)}),0)}))}function ue(e){var r,t=e.container,n=null,o=null,h=null,v=0,m={},b={},y={};t.openChannel({service:"fsevents"},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");n=t,t.onCommand((function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw new Error("Expected fileEvent");var r=e.fileEvent,t=r.file,n=r.dest,o=r.op;if(t){var i=t.path;if(null!==i&&null!==o&&void 0!==i&&void 0!==o){var a;if(Z(),m[i]||t.type===d.api.File.Type.DIRECTORY)a=u.Tv.Directory;else{var s=Object.keys(m).find((function(e){return(0,f.pC)(e,i)})),c=s&&m[s].children.find((function(e){return e.filename===(0,l.UO)(i)}));a=c?c.type:u.Tv.File}switch(o){case d.api.FileEvent.Op.Create:_({eventType:u.kS.Create,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Modify:if(a===u.Tv.Directory)break;_({eventType:u.kS.Modify,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Remove:_({eventType:u.kS.Delete,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Move:if(null==n||null==n.path)throw new Error("Expected dest path");var p=n.path;_({eventType:u.kS.Move,node:{path:i,type:a},to:p})}}}}}));var o=(0,s.Z)(new Set([].concat((0,s.Z)(Object.keys(m)),(0,s.Z)(Object.keys(b)),(0,s.Z)(Object.keys(y)))));return o.length&&t.send({subscribeFile:{files:o.map((function(e){return{path:e}}))}}),function(){n=null}}}));var g=new Promise((function(e){return r=e}));t.openChannel({service:function(e){return e.repl.currentUserPermissions.containerWrite?"gcsfiles":"files"}},(function(e){var t=e.error,n=e.channel;if(!t){if(!n)throw new Error("Expected channel");return r(n),function(){g=new Promise((function(e){return r=e}))}}}));var w=(0,re.Z)();w.promise.catch((function(e){return e}));var x=(0,ee.Z)((0,a.Z)(i().mark((function e(){var r,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.promise;case 2:return r=e.sent,e.next=5,r.request({fsSnapshot:{}});case 5:if(!(t=e.sent).channelClosed){e.next=8;break}return e.abrupt("return",{success:!1,error:"channel closed"});case 8:if(!t.error){e.next=10;break}return e.abrupt("return",{success:!1,error:t.error});case 10:return e.abrupt("return",{success:!0});case 11:case"end":return e.stop()}}),e)}))),{wait:5e3,maxWait:1e4});t.openChannel({service:"snapshot",skip:function(e){return!e.repl.currentUserPermissions.containerWrite}},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");return w.resolve(t),function(){w.isFulfilled&&(w=(0,re.Z)()).promise.catch((function(e){return e}))}}w.isFulfilled||w.reject(r)}));var C=u.kO.Clean,E=[],O=0;function Z(){return D.apply(this,arguments)}function D(){return(D=(0,a.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O++,F(),e.next=4,B.persist();case 4:O--,F();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return j.apply(this,arguments)}function j(){return(j=(0,a.Z)(i().mark((function e(){var r,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0===O&&0===R.length&&Object.values(b).every((function(e){return e.otClient.isClean()})),t=C===u.kO.Clean,r!==t){e.next=4;break}return e.abrupt("return");case 4:C=r?u.kO.Clean:u.kO.Syncing,E.forEach((function(e){e(C)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=[];function P(e){R.push(e),F(),e.then((function(){var r=R.indexOf(e);r>-1&&R.splice(r,1),Z()}))}function I(e,r){return N.apply(this,arguments)}function N(){return(N=(0,a.Z)(i().mark((function e(r,t){var n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(n=function(){var e=(0,a.Z)(i().mark((function e(){var t,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g;case 2:return t=e.sent,e.next=5,t.request(r);case 5:if(!(o=e.sent).channelClosed){e.next=8;break}return e.abrupt("return",ce(n));case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())(),t.isMutative&&P(o),e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){h=null;var r=e.node.path.includes("/")?(0,l.Il)(e.node.path):p.Q,t=m[r],n=(0,l.UO)(e.node.path);if(!n)throw new Error("Expected filename");var o=null;if(e.eventType===u.kS.Move){var i=e.to.includes("/")?(0,l.Il)(e.to):p.Q;o=m[i]}if(t||o)switch(e.eventType){case u.kS.Create:var a,c=[].concat((0,s.Z)(t.children.filter((function(e){return e.filename!==n}))),[{type:e.node.type,filename:n}]),d=oe(t.listeners);try{for(d.s();!(a=d.n()).done;){(0,a.value.onChange)(c)}}catch(J){d.e(J)}finally{d.f()}t.children=c;break;case u.kS.Move:var v=(0,l.UO)(e.to);if(t===o){var g,w=[].concat((0,s.Z)(t.children.filter((function(e){return e.filename!==n&&e.filename!==v}))),[{type:e.node.type,filename:v}]),k=oe(t.listeners);try{for(k.s();!(g=k.n()).done;){(0,g.value.onChange)(w)}}catch(J){k.e(J)}finally{k.f()}t.children=w;break}if(t){var x,C=t.children.filter((function(e){return e.filename!==n})),E=oe(t.listeners);try{for(E.s();!(x=E.n()).done;){(0,x.value.onChange)(C)}}catch(J){E.e(J)}finally{E.f()}t.children=C}if(o){var O,Z=[].concat((0,s.Z)(o.children.filter((function(e){return e.filename!==n&&e.filename!==v}))),[{type:e.node.type,filename:v}]),S=oe(o.listeners);try{for(S.s();!(O=S.n()).done;){(0,O.value.onChange)(Z)}}catch(J){S.e(J)}finally{S.f()}o.children=Z}break;case u.kS.Delete:var T,D=t.children.filter((function(e){return e.filename!==n})),F=oe(t.listeners);try{for(F.s();!(T=F.n()).done;){(0,T.value.onChange)(D)}}catch(J){F.e(J)}finally{F.f()}t.children=D;break;case u.kS.Modify:break;default:throw new Error("unknown event")}switch(e.eventType){case u.kS.Move:case u.kS.Delete:for(var j=0,R=[b[e.node.path],y[e.node.path],m[e.node.path]];j<R.length;j++){var P=R[j];if(P){var I,N=oe(P.listeners);try{for(N.s();!(I=N.n()).done;){var A=I.value,L=A.onMoveOrDelete,U=A.dispose;L&&L(e),U()}}catch(J){N.e(J)}finally{N.f()}}}if(e.node.type===u.Tv.File)break;var M,z=[],V=oe(Object.values(ne(ne(ne({},m),y),b)).sort());try{for(V.s();!(M=V.n()).done;){var q=M.value;if((0,f.yr)(e.node.path,q.path)){var W=z.slice(-1)[0];if(!W||!(0,f.yr)(W,q.path)){var G={eventType:u.kS.Delete,node:{path:q.path,type:q.type}};e.eventType===u.kS.Move&&(G=ne(ne({},G),{},{eventType:u.kS.Move,to:(0,f.hk)(e.node.path,e.to,q.path)})),z.push(q.path),_(G)}}}}catch(J){V.e(J)}finally{V.f()}break;case u.kS.Create:case u.kS.Modify:if(!y[e.node.path])break;B.readFile(e.node.path).then((function(r){var t=y[e.node.path];if(t)if(r.error)_({eventType:u.kS.Delete,node:{path:e.node.path,type:u.Tv.File}});else{var n,o=oe(t.listeners);try{for(o.s();!(n=o.n()).done;){var i=n.value.onChange;i&&i(r.content)}}catch(J){o.e(J)}finally{o.f()}}})).catch((function(e){e.message="File read after modify error: "+e.message,Y.Tb(e)}))}}function A(){return L.apply(this,arguments)}function L(){return(L=(0,a.Z)(i().mark((function e(){var r,n,o,a,c,u,l,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.performance.now(),e.next=3,t.exec.apply(t,["ag","--noaffinity","-g *","--hidden"].concat((0,s.Z)(K.ignoredDirs.map((function(e){return"--ignore=".concat(e)})))));case 3:if(o=e.sent,a=o.output,c=o.error,(0,S.track)(S.events.LIST_FILES_EXECUTED,{duration:window.performance.now()-n,failed:Boolean(c)&&"exit status 1"!==c}),u=null===(r=t.getContext())||void 0===r?void 0:r.repl){e.next=10;break}throw new Error("Expected repl");case 10:if(l=function(e){return!!e&&(!(0,K.isHiddenFile)(e)&&!X().isLangFileBinary(u.language,e))},c||!a){e.next=14;break}return h={error:null,files:a.split("\n").filter(l)},e.abrupt("return",h);case 14:if(!c||!c.includes("not found")){e.next=22;break}return e.next=17,t.exec("find",".","-type","f","-print0");case 17:if(f=e.sent,(0,S.track)(S.events.AG_NOT_AVAILABLE,{language:u.language}),!f.output){e.next=22;break}return h={error:null,files:f.output.slice(2,-1).split("\0./").filter(l)},e.abrupt("return",h);case 22:return"exit status 1"!==c&&Y.Tb(new Error("Find file command failed with error: ".concat(c))),e.abrupt("return",{error:c,files:null});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(){var e=(0,a.Z)(i().mark((function e(r,t,n){var o,s,c,l,f,p,d,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(){return(c=(0,a.Z)(i().mark((function e(r){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.request(r);case 2:if(!(t=e.sent).channelClosed){e.next=5;break}throw new Error("channelClosed");case 5:if(!t.error){e.next=7;break}throw new Error(t.error);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)},s=function(e){return c.apply(this,arguments)},e.next=4,g;case 4:return o=e.sent,e.prev=5,e.next=8,s({transferStart:{path:r,size:t.length}});case 8:if(l=e.sent,f=l.transfer){e.next=12;break}throw new Error("Failed to start a transfer (no transfer id)");case 12:p=t.toBuffer(),d=512e3,n(p.length,0),h=0;case 16:if(!(h<Math.ceil(t.length/d))){e.next=23;break}return e.next=19,s({transferChunk:{id:f.id,content:p.subarray(h*d,(h+1)*d)}});case 19:n(p.length,Math.min(p.length,(h+1)*d));case 20:h++,e.next=16;break;case 23:return e.next=25,s({transferComplete:{id:f.id,crc32:k.buf(p)}});case 25:e.next=36;break;case 27:if(e.prev=27,e.t0=e.catch(5),"channelClosed"!==e.t0.message){e.next=31;break}return e.abrupt("return",ce(B.transferFile,r,t,n));case 31:if(!e.t0.message.includes("not a directory")){e.next=33;break}return e.abrupt("return",{error:u.Df.NotDirectory});case 33:if(!e.t0.message.includes("file exists")){e.next=35;break}return e.abrupt("return",{error:u.Df.IsDirectory});case 35:throw e.t0;case 36:return _({eventType:u.kS.Create,node:{path:r,type:u.Tv.File}}),e.abrupt("return",{error:null});case 38:case"end":return e.stop()}}),e,null,[[5,27]])})));return function(r,t,n){return e.apply(this,arguments)}}();function M(e){if(e.startsWith("/home/runner"))throw new Error("watchOtFile requires relative paths");var r=new $(e,t);return r.on("commitComplete",Z),r.on("fileDirty",F),r.on("fileClean",F),r.on("commitStart",F),r}var B={getStatus:function(){return C},onStatusChange:function(e){return E.push(e),function(){var r=E.indexOf(e);r>-1&&E.splice(r,1)}},watchDir:function(e,r){var t=!1,o=function r(){t=!0,m[e]&&(m[e].listeners=m[e].listeners.filter((function(e){return e.dispose!==r})),0===m[e].listeners.length&&delete m[e])};return B.readDir(e).then((function(i){if(!t){if(i.error){var a=new Error(i.error);return a.code=i.error,r.onError(a),void o()}m[e]||(m[e]={path:e,type:u.Tv.Directory,children:i.children,listeners:[]},n&&n.send({subscribeFile:{files:[{path:e}]}})),m[e].listeners.push(ne(ne({},r),{},{dispose:o})),r.onChange(i.children)}})).catch((function(e){o(),r.onError(e)})),o},writeFile:function(e,r){return(0,a.Z)(i().mark((function t(){var n,o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I({write:{path:e,content:r.toBuffer()}},{isMutative:!0});case 2:if(!(n=t.sent).error){t.next=9;break}if(o=null,n.error.includes("not a directory")?o=u.Df.NotDirectory:n.error.includes("file exists")&&(o=u.Df.IsDirectory),o){t.next=8;break}throw new Error(n.error);case 8:return t.abrupt("return",{error:o});case 9:return y[e]||b[e]||m[(0,l.Il)(e)]&&m[(0,l.Il)(e)].children.some((function(r){return r.filename===(0,l.UO)(e)}))?_({eventType:u.kS.Modify,node:{path:e,type:u.Tv.File}}):_({eventType:u.kS.Create,node:{path:e,type:u.Tv.File}}),t.abrupt("return",{error:null});case 11:case"end":return t.stop()}}),t)})))()},transferFile:function(){var e=arguments;return(0,a.Z)(i().mark((function r(){var t;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return P(t=U.apply(void 0,(0,s.Z)(e))),r.abrupt("return",t);case 3:case"end":return r.stop()}}),r)})))()},readFile:function(e){return(0,a.Z)(i().mark((function r(){var t,n,o;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!b[e]){r.next=3;break}return t=b[e].otClient.localContent,r.abrupt("return",{content:c.Z.from(t),error:null});case 3:return r.next=5,I({read:{path:e}},{isMutative:!1});case 5:if(!(n=r.sent).error){r.next=12;break}if(o=null,ae(n.error)?o=u.Df.NotFound:n.error.includes("is a directory")&&(o=u.Df.IsDirectory),o){r.next=11;break}throw new Error(n.error);case 11:return r.abrupt("return",{error:o});case 12:if(n.file&&n.file.path&&n.file.content){r.next=14;break}throw new Error("Expected file");case 14:return r.abrupt("return",{content:c.Z.from(n.file.content),error:null});case 15:case"end":return r.stop()}}),r)})))()},createDir:function(e){return(0,a.Z)(i().mark((function r(){var t,n;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,I({mkdir:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,t.error.includes("not a directory")&&(n=u.Df.NotDirectory),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return _({eventType:u.kS.Create,node:{path:e,type:u.Tv.Directory}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},moveDir:function(e,r){return(0,a.Z)(i().mark((function t(){var n,o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I({move:{oldPath:e,newPath:r}},{isMutative:!0});case 2:if(!(n=t.sent).error){t.next=8;break}if(o=se(n.error)){t.next=7;break}throw new Error(n.error);case 7:return t.abrupt("return",{error:o});case 8:return _({eventType:u.kS.Move,node:{path:e,type:u.Tv.Directory},to:r}),t.abrupt("return",{error:null});case 10:case"end":return t.stop()}}),t)})))()},moveFile:function(e,r){return(0,a.Z)(i().mark((function t(){var n,o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I({move:{oldPath:e,newPath:r}},{isMutative:!0});case 2:if(!(n=t.sent).error){t.next=8;break}if(o=se(n.error)){t.next=7;break}throw new Error(n.error);case 7:return t.abrupt("return",{error:o});case 8:return _({eventType:u.kS.Move,node:{path:e,type:u.Tv.File},to:r}),t.abrupt("return",{error:null});case 10:case"end":return t.stop()}}),t)})))()},copyFile:function(e,r){return(0,a.Z)(i().mark((function t(){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.readFile(e);case 2:if(!(n=t.sent).error){t.next=5;break}return t.abrupt("return",n);case 5:return t.abrupt("return",B.writeFile(r,n.content));case 6:case"end":return t.stop()}}),t)})))()},copyDirFromRemote:function(e,r,t){var n=this;return(0,a.Z)(i().mark((function o(){var a,s,c,l,f,p,d,h,v;return i().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,n.deleteDir(e);case 2:return o.next=4,t.readDir(e);case 4:if(!(a=o.sent).error){o.next=7;break}return o.abrupt("return",a);case 7:return o.next=9,n.readDir(r);case 9:if((s=o.sent).error!==u.Df.NotFound){o.next=15;break}return o.next=13,n.createDir(e);case 13:o.next=17;break;case 15:if(s.error!==u.Df.NotDirectory){o.next=17;break}return o.abrupt("return",s);case 17:c=oe(a.children),o.prev=18,c.s();case 20:if((l=c.n()).done){o.next=44;break}if(f=l.value,p="".concat(e,"/").concat(f.filename),f.type!==u.Tv.File){o.next=36;break}return o.next=26,t.readFile(p);case 26:if(!(d=o.sent).error){o.next=29;break}return o.abrupt("return",d);case 29:return o.next=31,n.writeFile("".concat(r,"/").concat(f.filename),d.content);case 31:if(!(h=o.sent).error){o.next=34;break}return o.abrupt("return",h);case 34:o.next=42;break;case 36:if(f.type!==u.Tv.Directory){o.next=42;break}return o.next=39,n.copyDirFromRemote(p,"".concat(r,"/").concat(f.filename),t);case 39:if(!(v=o.sent).error){o.next=42;break}return o.abrupt("return",v);case 42:o.next=20;break;case 44:o.next=49;break;case 46:o.prev=46,o.t0=o.catch(18),c.e(o.t0);case 49:return o.prev=49,c.f(),o.finish(49);case 52:return o.abrupt("return",{error:null});case 53:case"end":return o.stop()}}),o,null,[[18,46,49,52]])})))()},deleteFile:function(e){return(0,a.Z)(i().mark((function r(){var t,n;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,I({remove:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,ae(t.error)&&(n=u.Df.NotFound),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return _({eventType:u.kS.Delete,node:{path:e,type:u.Tv.File}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},deleteDir:function(e){return(0,a.Z)(i().mark((function r(){var t,n;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,I({remove:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,ae(t.error)&&(n=u.Df.NotFound),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return _({eventType:u.kS.Delete,node:{path:e,type:u.Tv.Directory}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},readDir:function(e){return(0,a.Z)(i().mark((function r(){var t,n,o,a;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,I({readdir:{path:e}},{isMutative:!1});case 2:if(!(n=r.sent).error){r.next=9;break}if(o=null,ae(n.error)?o=u.Df.NotFound:n.error.includes("not a directory")&&(o=u.Df.NotDirectory),o){r.next=8;break}throw new Error(n.error);case 8:return r.abrupt("return",{error:o});case 9:if(null!==(t=n.files)&&void 0!==t&&t.files){r.next=11;break}throw new Error("Expected filesChannel");case 11:return a=n.files.files.map((function(e){if(!e.path)throw new Error("Expected path");return{filename:e.path,type:e.type===d.api.File.Type.DIRECTORY?u.Tv.Directory:u.Tv.File}})),r.abrupt("return",{children:a,error:null});case 13:case"end":return r.stop()}}),r)})))()},stat:function(e){return(0,a.Z)(i().mark((function r(){var t;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,I({stat:{path:e}},{isMutative:!1});case 2:if(!(t=r.sent).error){r.next=5;break}throw new Error(t.error);case 5:if(t.statRes){r.next=7;break}throw new Error("expected stat result");case 7:if(t.statRes.exists){r.next=9;break}return r.abrupt("return",{exists:!1});case 9:if(t.statRes.type!==d.api.File.Type.DIRECTORY){r.next=11;break}return r.abrupt("return",{exists:!0,type:u.Tv.Directory,lastModified:new Date(1e3*t.statRes.modTime)});case 11:return r.abrupt("return",{exists:!0,type:u.Tv.File,lastModified:new Date(1e3*t.statRes.modTime),byteLength:Number(t.statRes.size)});case 12:case"end":return r.stop()}}),r)})))()},watchOtFile:function(e,r,t){var n=this;b[e]||(b[e]={path:e,type:u.Tv.File,listeners:[],otClient:M(e)}),t&&(b[e].otClient.shouldTrackReconnects=!0);var o=!1,s=function(){},l=function l(p){s();var d=function(e){var t;return null===(t=r.onFlush)||void 0===t?void 0:t.call(r,e)};b[e].otClient.on("commitComplete",d);var h=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Dirty)};b[e].otClient.on("fileDirty",h);var v=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Clean)};b[e].otClient.on("fileClean",v);var m=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Syncing)};b[e].otClient.on("commitStart",m);var y=function(e){var t;return null===(t=r.onCursor)||void 0===t?void 0:t.call(r,e)};b[e].otClient.on("cursor",y);var g=function(e){var t;return null===(t=r.onRemoveCursor)||void 0===t?void 0:t.call(r,e)};b[e].otClient.on("removeCursor",g);var w=function(){var r=(0,a.Z)(i().mark((function r(o){var a,s,u,l,f,p,d;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if((a=b[e].otClient).destroy(),s=function(){var r=M(e);return t&&(r.shouldTrackReconnects=!0),new Promise((function(t,n){r.once("op",(function(){var n=a.localContent,o=r.localContent,i=(0,T.sQ)(n,o);b[e].otClient=r;var s,c=oe(b[e].listeners);try{for(c.s();!(s=c.n()).done;){(0,s.value.reregister)(i)}}catch(u){c.e(u)}finally{c.f()}t()})),r.once("error",(function(e){return n(e)}))}))},"remote"!==o){r.next=7;break}return r.next=6,s();case 6:return r.abrupt("return");case 7:return r.next=9,n.writeFile(e,c.Z.from(a.localContent));case 9:if(!(u=r.sent).error){r.next=16;break}(l=new Error("Got error while overwriting file during reconnect")).code=u.error,f=oe(b[e].listeners);try{for(f.s();!(p=f.n()).done;)(d=p.value).onError&&d.onError(l),d.dispose()}catch(i){f.e(i)}finally{f.f()}return r.abrupt("return");case 16:return r.next=18,s();case 18:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),k=function(){var e;return null===(e=r.onReconnectFail)||void 0===e?void 0:e.call(r,w)};b[e].otClient.on("promptUserReconnect",k),b[e].listeners[0].reregister===l&&b[e].otClient.on("promptUserReconnect",(function(){b[e]&&(b[e].listeners.some((function(e){return e.onReconnectFail}))||w("remote"))}));var x=function(e,t){r.onError&&r.onError(e,t),f()};b[e].otClient.on("error",x);var C,E=function(t){b[e].otClient.writeOps(t);var n,o=oe(b[e].listeners);try{for(o.s();!(n=o.n()).done;){var i=n.value.onChange;i&&i!==r.onChange&&i({ops:t,changeSource:u.Fl.Local,version:b[e].otClient.version,latestContent:b[e].otClient.localContent})}}catch(a){o.e(a)}finally{o.f()}},O=function(r){b[e].otClient.updateCursors(r)};(-1!==b[e].otClient.version&&setTimeout((function(){var t;o||null===(t=r.onReady)||void 0===t||t.call(r,{initialContent:c.Z.from(b[e].otClient.localContent),writeOps:E,updateSelections:O,fetchOps:b[e].otClient.fetchOps,transformSelection:b[e].otClient.transformSelection,version:b[e].otClient.version})})),p)&&(null===(C=r.onChange)||void 0===C||C.call(r,{ops:p,changeSource:u.Fl.Container,version:b[e].otClient.version,latestContent:b[e].otClient.localContent}));var Z=function(t){var n,i;if(!o)return o=!0,void(null===(i=r.onReady)||void 0===i||i.call(r,{initialContent:c.Z.from(b[e].otClient.localContent),writeOps:E,updateSelections:O,fetchOps:b[e].otClient.fetchOps,transformSelection:b[e].otClient.transformSelection,version:b[e].otClient.version}));null===(n=r.onChange)||void 0===n||n.call(r,{ops:t,changeSource:u.Fl.Container,version:b[e].otClient.version,latestContent:b[e].otClient.localContent})};b[e].otClient.on("op",Z),s=function(){b[e].otClient.removeListener("commitComplete",d),b[e].otClient.removeListener("fileDirty",h),b[e].otClient.removeListener("fileClean",v),b[e].otClient.removeListener("commitStart",m),b[e].otClient.removeListener("error",x),b[e].otClient.removeListener("op",Z),b[e].otClient.removeListener("cursor",y),b[e].otClient.removeListener("removeCursor",g),b[e].otClient.removeListener("promptUserReconnect",k)},F()},f=function r(){b[e]&&(o=!0,s(),b[e].listeners=b[e].listeners.filter((function(e){return e.dispose!==r})),0===b[e].listeners.length&&(b[e].otClient.destroy(),delete b[e]))};return b[e].listeners.push(ne(ne({},r),{},{dispose:f,reregister:l})),l(),f},watchFile:function(e,r){var t=!1,o=function r(){t=!0,y[e]&&(y[e].listeners=y[e].listeners.filter((function(e){return e.dispose!==r})),0===y[e].listeners.length&&delete y[e])};return B.readFile(e).then((function(i){if(!t){if(i.error){var a=new Error(i.error);return a.code=i.error,r.onError(a),void o()}y[e]||(y[e]={path:e,type:u.Tv.File,listeners:[]},n&&n.send({subscribeFile:{files:[{path:e}]}})),y[e].listeners.push(ne(ne({},r),{},{dispose:o})),r.onChange(i.content)}})),o},listFiles:function(){return(0,a.Z)(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(h&&window.performance.now()-v<1e4)){e.next=2;break}return e.abrupt("return",h);case 2:return o||(o=A(),v=window.performance.now()),e.next=5,o;case 5:return r=e.sent,o=null,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))()},flush:function(){for(var e=[],r=0,t=Object.values(b);r<t.length;r++){var n=t[r];e.push(n.otClient.flush())}return Promise.all([].concat(e,R).map((function(e){return e.catch((function(){}))}))).then((function(){}))},persist:function(e){var r=x();return e&&e.skipDebounce&&x.flush(),r},getOTVersion:function(e){var r=b[e];if(!r)throw new Error("No file with path ".concat(e," found."));return r.otClient.version}};return B}},2244:function(e,r,t){"use strict";t.d(r,{qC:function(){return u},sQ:function(){return p},vs:function(){return d}});var n=t(32292),o=t(37529),i=t.n(o),a=function(e){return e.length>0&&"number"===typeof e[e.length-1]&&e.pop(),e},s=function(e){if(!Array.isArray(e))throw Error("Op must be an array of components");for(var r=null,t=0;t<e.length;t++){var n=e[t];switch(typeof n){case"object":if(!("number"===typeof n.d&&n.d>0))throw Error("Object components must be deletes of size > 0");break;case"string":if(!(n.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(n>0))throw Error("Skip components must be >0");if("number"===typeof r)throw Error("Adjacent skip components should be combined")}r=n}if("number"===typeof r)throw Error("Op has a trailing skip")},c=function(e){return"number"===typeof e?e:"string"===typeof e?e.length:e.d};function u(e,r){s(e),s(r);for(var t,n=[],o=l(n),i=f(e)[0],u=0;u<r.length;u++){var p=r[u],d=void 0,h=void 0;switch(typeof p){case"number":for(d=p;d>0;)(h=i(d,"d"))&&o(h),"object"!==typeof h&&(d-=c(h));break;case"string":o(p);break;case"object":for(d=p.d;d>0;)switch(typeof(h=i(d,"d"))){case"number":o({d:h}),d-=h;break;case"string":d-=h.length;break;case"object":h&&o(h)}}}for(;t=i(-1);)o(t);return a(n)}function l(e){return function(r){r&&0!==r.d&&(0===e.length?e.push(r):typeof r===typeof e[e.length-1]?"object"===typeof r?e[e.length-1].d+=r.d:e[e.length-1]+=r:e.push(r))}}function f(e){var r=0,t=0;return[function(n,o){if(r===e.length)return-1===n?null:n;var i,a=e[r];return"number"===typeof a?-1===n||a-t<=n?(i=a-t,++r,t=0,i):(t+=n,n):"string"===typeof a?-1===n||"i"===o||a.length-t<=n?(i=a.slice(t),++r,t=0,i):(i=a.slice(t,t+n),t+=n,i):-1===n||"d"===o||a.d-t<=n?(i={d:a.d-t},++r,t=0,i):(t+=n,{d:n})},function(){return e[r]}]}function p(e,r){if(e===r)return[];var t=[],o=function(e){e&&0!==e.d&&(0===t.length?t.push(e):typeof e===typeof t[t.length-1]?"object"===typeof e?t[t.length-1].d+=e.d:t[t.length-1]+=e:t.push(e))};return i()(e,r).forEach((function(e){var r=(0,n.Z)(e,2),t=r[0],a=r[1];switch(t){case i().INSERT:o(a);break;case i().DELETE:o({d:a.length});break;case i().EQUAL:o(a.length)}})),t.length>0&&"number"===typeof t[t.length-1]&&t.pop(),t}function d(e,r,t){if("left"!==t&&"right"!==t)throw Error("side ("+t+") must be 'left' or 'right'");s(e),s(r);for(var o,i=[],u=l(i),p=f(e),d=(0,n.Z)(p,2),h=d[0],v=d[1],m=0;m<r.length;m++){var b=r[m],y=void 0,g=void 0;switch(typeof b){case"number":for(y=b;y>0;)u(g=h(y,"i")),"string"!==typeof g&&(y-=c(g));break;case"string":"left"===t&&"string"===typeof v()&&u(h(-1)),u(b.length);break;case"object":for(y=b.d;y>0;)switch(typeof(g=h(y,"i"))){case"number":y-=g;break;case"string":u(g);break;case"object":y-=g.d}}}for(;o=h(-1);)u(o);return a(i)}},26921:function(e,r,t){"use strict";t.d(r,{Z:function(){return p}});var n=t(809),o=t.n(n),i=t(92447),a=t(37348),s=t.n(a),c=t(50055),u=t(79381),l=t(64027),f=t(35894);function p(e){var r=e.container,t=e.beforeRun,n=(0,l.Z)(),a=null,p=u.A.OFFLINE,d="none",h=!1,v=Math.random();function m(){var e=function(e){p!==e&&(p=e,n.emit(u.z.STATE_CHANGE,p))};e(a?h?u.A.STOPPING:"none"===d?u.A.IDLE:u.A.RUNNING:u.A.OFFLINE)}function b(){return(b=(0,i.Z)(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p===u.A.IDLE){e.next=2;break}throw new Error("Cannot run while state is not IDLE, got state: "+p);case 2:return r=Math.random(),v=r,d="before-run",m(),e.next=8,t();case 8:if(v===r){e.next=10;break}return e.abrupt("return");case 10:if("none"!==d){e.next=12;break}return e.abrupt("return");case 12:if("server"!==d){e.next=14;break}return e.abrupt("return");case 14:if(a){e.next=16;break}throw new Error("State is RUNNING but shellrunner is null?");case 16:d="optimistic",a.send({runMain:{}});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=(0,i.Z)(o().mark((function e(r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p===u.A.IDLE||p===u.A.RUNNING){e.next=2;break}throw new Error("Can only send input when running or idle");case 2:if(a){e.next=4;break}throw new Error("State is not OFFLINE but shellrunner is null?");case 4:a.send({input:r});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.openChannel({name:"shellrunner",service:"shellrun2",skip:function(e){var r,t=e.repl;return!(0,f.w)()||(r=t.language,!(!0===s().usesInterpreter(r)||!1!==s().usesRunProject(r)))}},(function(e){var r=e.channel;if(!e.error){if(!r)throw new Error("Expected error");return a=r,m(),r.onCommand((function(e){if(null!=e.state){var r=e.state===c.api.State.Stopped;h&&r&&(h=!1),r?"server"===d&&(d="none"):d="server",m()}else null!=e.output&&n.emit(u.z.OUTPUT,e.output)})),function(){d="none",h=!1,a=null,m()}}})),{run:function(){return b.apply(this,arguments)},stopRun:function(){if(p!==u.A.RUNNING)throw new Error("stopRun must be called when running but got ".concat(p));if(!a)throw new Error("State is RUNNING but shellrunner is null?");if("before-run"===d)return d="none",void m();d="none",h=!0,m(),a.send({clear:{}})},sendInput:function(e){return y.apply(this,arguments)},resizeTerminal:function(e){if(!a)throw new Error("resizeTerminal must be called when online");a.send({resizeTerm:e})},onOutput:function(e){return n.on(u.z.OUTPUT,e),function(){n.removeListener(u.z.OUTPUT,e)}},onStateChanged:function(e){return n.on(u.z.STATE_CHANGE,e),function(){n.removeListener(u.z.STATE_CHANGE,e)}},getRunState:function(){return p}}}},3460:function(e,r,t){"use strict";var n=t(74047),o=t(52700),i=t(48764).Buffer,a=function(){function e(r,t){if((0,n.Z)(this,e),this.asEncoding={},this.asBuffer=null,t&&"string"===typeof r)this.asEncoding[t]=r;else if(void 0===r||null===r)this.asBuffer=i.alloc(0);else if(r instanceof i)this.asBuffer=r;else if("string"===typeof r)this.asEncoding.utf8=r;else if(r instanceof ArrayBuffer)this.asBuffer=i.from(r);else{if(r instanceof e)return r;r instanceof Uint8Array?this.asBuffer=i.from(r):"object"===typeof r&&"object"===typeof r.asEncoding&&null!==r.asEncoding&&(r.asBuffer instanceof i||null===r.asBuffer)&&(this.asBuffer=r.asBuffer||null,"string"===typeof r.asEncoding.base64&&(this.asEncoding={base64:r.asEncoding.base64}),"string"===typeof r.asEncoding.utf8&&(this.asEncoding={utf8:r.asEncoding.utf8}))}}return(0,o.Z)(e,null,[{key:"from",value:function(r,t){return new e(r,t)}},{key:"isBuffer",value:function(r){return r instanceof e}}]),(0,o.Z)(e,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";if(void 0!==this.asEncoding[e])return this.asEncoding[e];var r=this.toBuffer(),t=r.toString(e);return this.asEncoding[e]=t,t}},{key:"toJSON",value:function(){return{asEncoding:{base64:this.toString("base64")},asBuffer:null}}},{key:"toBuffer",value:function(){if(this.asBuffer)return this.asBuffer;for(var e in this.asEncoding){var r=this.asEncoding[e];if("string"===typeof r){var t=i.from(r,e);return this.asBuffer=t,t}}return this.asBuffer=i.alloc(0),this.asBuffer}},{key:"length",get:function(){return void 0!==this.asEncoding.utf8?this.asEncoding.utf8.length:this.toBuffer().length}}]),e}();r.Z=a},64181:function(e,r,t){"use strict";t.d(r,{Q:function(){return u}});var n=t(26265),o=t(561),i=t(87644);function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var c=new o.R({dsn:"https://7f707426a65447cc94b6fca9a2a4afb9@sentry.replit.com/14",release:"94eca86",environment:"production",beforeSend:function(e,r){var t;return r&&(t=r.originalException,Boolean(t&&"object"===typeof t&&"CustomSentryError"===t.name))&&(r.originalException.extras&&(e.extra=s(s({},e.extra),r.originalException.extras)),r.originalException.tags&&(e.tags=s(s({},e.tags),r.originalException.tags))),e}});function u(e,r){if((0,i.track)(i.events.WS_CRASHED),c){var t;try{throw new Error("Sentry syntheticException")}catch(n){t=n}return c.captureException(e,{originalException:e,syntheticException:t},r)}}},74143:function(e,r,t){"use strict";t.d(r,{GA:function(){return o},yr:function(){return i},pC:function(){return a},vk:function(){return s},hk:function(){return c}});function n(e){return""===e||e.endsWith("/")?e:e+"/"}function o(e,r){return Object.keys(e).filter((function(e){return i(r,e)}))}function i(e,r){return r!==e&&r.startsWith(n(e))}function a(e,r){if(!i(e,r))return!1;var t=n(e),o=r.slice(t.length);return o.endsWith("/")&&(o=o.slice(-1)),!o.includes("/")}function s(e,r,t){var n=o(e,r).map((function(e){return[e,c(r,t,e)]}));return"undefined"!==typeof e[r]&&n.unshift([r,t]),n}function c(e,r,t){var o=n(e);return n(r)+t.slice(o.length)}},23541:function(e,r,t){"use strict";t.d(r,{Rh:function(){return b},Zr:function(){return y},lD:function(){return g}});var n=t(35944),o=t(32292),i=t(65988),a=t(67294),s=t(41422),c=t(62255),u=t(86113),l=t(52577),f=t(25763),p=t(16578),d=t(79381);function h(e,r){var t;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return v(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return v(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function v(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var m=function(e,r){var t=e.runner,c=e.packager,u=e.languageHeader,l=e.onClear,v=function(e){var r=e.runner,t=e.packager,n=e.languageHeader,i=(0,p.Z)({}),s=(0,o.Z)(i,2),c=s[0],u=s[1],l=a.useState(""),f=(0,o.Z)(l,2),v=f[0],m=f[1];return a.useEffect((function(){if(!c)return r.onOutput((function(e){return m((function(r){return r+e}))}))}),[c,r,m]),a.useEffect((function(){if(!c&&t)return t.onOutput((function(e){return m((function(r){return r+e.replace(/\n/g,"\n\r")}))}))}),[c,t,m]),a.useEffect((function(){if(c&&t)return t.onOutput((function(e){return c.write(e.replace(/\n/g,"\n\r"))}))}),[c,t]),a.useEffect((function(){v&&c&&(c.write(v),m(""))}),[c,v]),a.useEffect((function(){n&&m((function(e){return e+"".concat(n.replace(/\n/g,"\n\r"),"\n\r")}))}),[n,m]),a.useEffect((function(){if(c){var e=function(){r.getRunState()!==d.A.OFFLINE&&r.resizeTerminal(c.getSize())},t=[];t.push(c.onResize(e).dispose);var n=[];t.push(c.onData((function(e){r.getRunState()!==d.A.OFFLINE?r.sendInput(e):n.push(e)})).dispose),t.push(r.onOutput((function(e){c.write(e)})));var o=!1;return t.push(r.onStateChanged((function(t){if(t!==d.A.OFFLINE){if(o||(e(),o=!0),n.length){var i,a=h(n);try{for(a.s();!(i=a.n()).done;){var s=i.value;r.sendInput(s)}}catch(c){a.e(c)}finally{a.f()}n=[]}}else o=!1}))),r.getRunState()!==d.A.OFFLINE&&(e(),o=!0),function(){t.forEach((function(e){return e()}))}}}),[c,r]),[c,u]}({runner:t,packager:c,languageHeader:u}),m=(0,o.Z)(v,2),w=m[0],k=m[1],x=a.useState(!1),C=(0,o.Z)(x,2),E=C[0],O=C[1];return a.useImperativeHandle(r,(function(){return{clear:function(){w&&w.clear()}}})),(0,n.BX)("div",{onKeyDown:function(e){"f"===e.key&&(0,s.jh)(e)&&!e.shiftKey&&(O(!0),e.preventDefault())},className:"jsx-1467601921 replit-ui-theme-root dark terminal",children:[(0,n.tZ)("div",{className:"jsx-1467601921 controls",children:(0,n.BX)(f.Ug,{align:"center",wrap:"nowrap",children:[E&&w?(0,n.tZ)(b,{findPrevious:w.findPrevious,findNext:w.findNext,exit:function(){return O(!1)}}):(0,n.tZ)(g,{onClick:function(){return O(!0)}}),(0,n.tZ)(y,{onClick:function(){w&&(w.clear(),l&&l(),u&&w.write("".concat(u.replace(/\n/g,"\n\r"),"\n\r")),w.focus())}})]})}),(0,n.tZ)("div",{ref:k,className:"jsx-1467601921 xterm-container"}),(0,n.tZ)(i.default,{id:"1467601921",children:[".terminal.jsx-1467601921{height:100%;width:100%;position:relative;background-color:var(--background-default);border-radius:var(--border-radius-4);padding-left:var(--space-16);padding-top:var(--space-4);}",".controls.jsx-1467601921{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;position:absolute;top:var(--space-8);right:var(--space-8);z-index:100;min-height:30px;}",".xterm-container.jsx-1467601921{height:100%;overflow:auto;}",".xterm-container.jsx-1467601921 .xterm{height:100%;}",".xterm-container.jsx-1467601921 .xterm-viewport{overflow-y:auto !important;border-radius:var(--border-radius-4);}"]})]})};function b(e){var r=e.findNext,t=e.findPrevious,s=e.exit,u=a.useRef(null),l=a.useState(""),f=(0,o.Z)(l,2),p=f[0],d=f[1];a.useEffect((function(){u.current&&u.current.focus()}),[]);return(0,n.BX)("div",{className:"jsx-2719349621 search",children:[(0,n.tZ)("input",{ref:u,placeholder:"Find",value:p,onChange:function(e){return d(e.target.value)},onKeyDown:function(e){return function(e){"Escape"!==e.key?"Enter"===e.key&&(e.shiftKey?t(p):r(p)):s()}(e)},className:"jsx-2719349621"}),(0,n.tZ)(c.Z,{size:"small",onClick:function(){return r(p)},children:"Next"}),(0,n.tZ)(c.Z,{size:"small",onClick:function(){return t(p)},children:"Previous"}),(0,n.tZ)(c.Z,{size:"small",onClick:s,children:"Exit"}),(0,n.tZ)(i.default,{id:"2719349621",children:[".search.jsx-2719349621{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:30px;}","input.jsx-2719349621{padding:4px var(--space-8) var(--space-4);background-color:var(--background-default);color:var(--white);height:24px;width:85px;border:none;border-radius:var(--border-radius-4);box-shadow:none;}","input.jsx-2719349621::-webkit-input-placeholder{color:var(--white);}","input.jsx-2719349621::-moz-placeholder{color:var(--white);}","input.jsx-2719349621:-ms-input-placeholder{color:var(--white);}","input.jsx-2719349621::placeholder{color:var(--white);}","input.jsx-2719349621:focus{outline:none;border:var(--accent-primary-default);}","input.jsx-2719349621,.search button{margin:0 var(--space-4);}"]})]})}r.ZP=a.forwardRef(m);var y=function(e){var r=e.onClick;return(0,n.BX)("button",{"aria-label":"Clear","data-microtip-position":"bottom-left",role:"tooltip",onClick:r,className:"jsx-259645926",children:[(0,n.tZ)(l.Z,{size:"medium"}),(0,n.tZ)(i.default,{id:"259645926",children:["button.jsx-259645926{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:var(--border-radius-4);padding:var(--space-4);background-color:var(--background-root);color:var(--foreground-default);-webkit-transition:background-color 0.2s;transition:background-color 0.2s;border:none;cursor:pointer;}","button.jsx-259645926:hover{background-color:var(--background-higher);}","button.jsx-259645926:focus{outline:none;}"]})]})},g=function(e){var r=e.onClick;return(0,n.BX)("button",{"aria-label":"Search","data-microtip-position":"bottom",role:"tooltip",onClick:r,className:"jsx-259645926",children:[(0,n.tZ)(u.Z,{size:"medium"}),(0,n.tZ)(i.default,{id:"259645926",children:["button.jsx-259645926{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:var(--border-radius-4);padding:var(--space-4);background-color:var(--background-root);color:var(--foreground-default);-webkit-transition:background-color 0.2s;transition:background-color 0.2s;border:none;cursor:pointer;}","button.jsx-259645926:hover{background-color:var(--background-higher);}","button.jsx-259645926:focus{outline:none;}"]})]})}},51339:function(e){e.exports={isHiddenFile:function(e){return/^(\.env$|\.npm$|\.npm\/|__pycache__|\.cache|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner)/.test(e)},ignoredDirs:[".git",".upm",".cache","__pycache__","node_modules"]}}}]);